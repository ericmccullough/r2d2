# install the OS, Ubuntu server 16.04 was used for this setup
# Create the r2d2 user during the installation
# Internet access is needed for initial install

# make sure the r2d2 user is in the sudoers group

####  set proxy if needed
export http_proxy=http://<your proxy IP/name here>:<port>
export https_proxy=http://<your proxy IP/name here>:<port>

# update the local apt repo to the latest
# may need to edit /etc/apt/sources.list and remove the cdrom line
sudo apt-get update

sudo apt-get install openssh-server

#
# Snapshot the VM if you are using virtualization
#

# ssh into the box, you'll want to be able to scroll back
ssh r2d2@<your.IP.goes.here>
##### GUI Install

#Install postgresql server and server-dev, the version may be different
sudo apt-get install postgresql postgresql-server-dev-9.5
su - postgres
# remember the password you are about to set
createuser --pwprompt r2d2
# the param is a capital o as in Owner
createdb -O r2d2 r2d2_production
# OPTIONAL: the next two are for development only
createdb -O r2d2 r2d2_dev
createdb -O r2d2 r2d2_test

psql
# be sure to include the ending semi-colon
  grant all privileges on database r2d2_production to r2d2;
# OPTIONAL: the next two are for development only
  grant all privileges on database r2d2_dev to r2d2;
  grant all privileges on database r2d2_test to r2d2;
  \q
# return to r2d2 user
exit

#Install RVM, see web site below for details
# https://rvm.io/rvm/install which refers to https://github.com/rvm/ubuntu_rvm
sudo apt-get install software-properties-common
sudo apt-add-repository -y ppa:rael-gc/rvm
sudo apt-get update
sudo apt-get install rvm

# exit and relogin as r2d2 to get profile changes

# install git
sudo apt-get install git

# install ruby 2 and rails 4
rvm install ruby-2.4.3
gem install rails --version=4.2.10 --no-document
# be in the directory you want the r2d2 directory installed into then
git clone -b gui --single-branch https://github.com/ericmccullough/r2d2.git
cd r2d2
#
# OPTIONAL: for testing, may need to install Selenium webdriver/geckodriver.
https://api.github.com/repos/mozilla/geckodriver/releases/latest
# copy the geckodriver to /usr/local/bin
# chmod to make it executable
# uses Firefox so install that too
# I did dev on an iMac
# on OS X, install xcode
#

# load the dependencies, may take a while
bundle install

# edit the r2d2/gui/config/database.yml and change the password to the r2d2 Postgres user's password

# rake db:create
rake db:schema:load

rake secret
# generates a long string, copy and append to next cmd
export SECRET_KEY_BASE=

#### To run in production:
bundle exec rake db:migrate RAILS_ENV=production
bundle exec rake db:seed RAILS_ENV=production
RAILS_ENV=production bin/rake assets:precompile

#### logout of server
exit

#
# Snapshot the VM if you are using virtualization
#

#### ssh with a tunnel to the server
ssh r2d2@<your.IP.goes.here> -L 4567:localhost:3000

bundle exec rails server -e production

# from your workstation browser
http://localhost:4567

# you should get to the home page
# with nothing but the default lists and MAC display settings